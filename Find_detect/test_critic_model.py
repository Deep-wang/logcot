"""
æµ‹è¯•è¯„åˆ¤æ¨¡å‹åŠŸèƒ½
éªŒè¯LLMClientè¯„åˆ¤æ¨¡å‹èƒ½å¦æ­£ç¡®è¯„ä¼°æ—¥å¿—åˆ†æç»“æœ
"""

from scan.summerize import critic_analysis


def test_critic_model():
    """
    æµ‹è¯•è¯„åˆ¤æ¨¡å‹åŠŸèƒ½
    """
    print("ğŸš€ å¼€å§‹æµ‹è¯•è¯„åˆ¤æ¨¡å‹")
    print("=" * 60)
    
    # ç¤ºä¾‹åˆ†æç»“æœï¼ˆæ¨¡æ‹ŸåŸå§‹åˆ†æè¾“å‡ºï¼‰
    sample_analysis = """
    ## æ—¥å¿—åˆ†æç»“æœ

    ### å¼‚å¸¸æƒ…å†µè¯†åˆ«ï¼š
    1. æ•°æ®åº“è¿æ¥è¶…æ—¶é—®é¢˜ - å‘ç”Ÿåœ¨2024-01-15 14:23:17
    2. æ”¯ä»˜ç½‘å…³å“åº”è¶…æ—¶ - å‘ç”Ÿåœ¨2024-01-15 15:30:03
    3. æ–‡ä»¶è¯»å–å¤±è´¥ - å‘ç”Ÿåœ¨2024-01-15 16:15:01

    ### æ•…éšœå½±å“èŒƒå›´ï¼š
    - ç”¨æˆ·ç™»å½•åŠŸèƒ½å—å½±å“ï¼Œç™»å½•æˆåŠŸç‡ä¸‹é™
    - è®¢å•æ”¯ä»˜æµç¨‹ä¸­æ–­ï¼Œéƒ¨åˆ†è®¢å•çŠ¶æ€å¼‚å¸¸
    - æ–‡ä»¶æœåŠ¡ä¸å¯ç”¨ï¼Œå½±å“æ–‡æ¡£ä¸‹è½½åŠŸèƒ½

    ### å› æœå…³ç³»åˆ†æï¼š
    æ•°æ®åº“è¿æ¥é—®é¢˜å¯¼è‡´ç”¨æˆ·è®¤è¯å¤±è´¥ï¼Œè¿›è€Œå½±å“äº†æ•´ä¸ªä¸šåŠ¡æµç¨‹ã€‚
    æ”¯ä»˜ç½‘å…³è¶…æ—¶é—®é¢˜ç‹¬ç«‹å­˜åœ¨ï¼Œä¸æ•°æ®åº“é—®é¢˜æ— ç›´æ¥å…³ç³»ã€‚

    ### å»ºè®®è§£å†³æ–¹æ¡ˆï¼š
    1. æ£€æŸ¥æ•°æ®åº“æœåŠ¡å™¨çŠ¶æ€å’Œç½‘ç»œè¿æ¥
    2. è”ç³»æ”¯ä»˜ç½‘å…³æœåŠ¡å•†ç¡®è®¤æœåŠ¡çŠ¶æ€
    3. æ£€æŸ¥æ–‡ä»¶æœåŠ¡å™¨ç£ç›˜ç©ºé—´å’Œæƒé™é…ç½®
    """
    
    # ç¤ºä¾‹åŸå§‹æ—¥å¿—ï¼ˆæ¨¡æ‹ŸçœŸå®æ—¥å¿—æ•°æ®ï¼‰
    sample_logs = """
    2024-01-15 14:23:15 INFO [UserController] å¤„ç†ç”¨æˆ·ç™»å½•è¯·æ±‚: user_id=12345
    2024-01-15 14:23:16 INFO [AuthService] éªŒè¯ç”¨æˆ·å‡­æ®
    2024-01-15 14:23:17 ERROR [DatabaseConnection] è¿æ¥è¶…æ—¶: Connection timeout after 30 seconds
    2024-01-15 14:23:18 WARN [AuthService] æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œå°è¯•é‡è¿
    2024-01-15 14:23:19 ERROR [AuthService] é‡è¿å¤±è´¥ï¼ŒæœåŠ¡ä¸å¯ç”¨
    2024-01-15 14:23:20 INFO [UserController] è¿”å›ç™»å½•å¤±è´¥å“åº”
    
    2024-01-15 15:30:01 INFO [OrderService] å¼€å§‹å¤„ç†è®¢å•åˆ›å»ºè¯·æ±‚
    2024-01-15 15:30:02 INFO [PaymentService] éªŒè¯æ”¯ä»˜ä¿¡æ¯
    2024-01-15 15:30:03 ERROR [PaymentService] æ”¯ä»˜ç½‘å…³å“åº”è¶…æ—¶
    2024-01-15 15:30:04 WARN [OrderService] æ”¯ä»˜éªŒè¯å¤±è´¥ï¼Œè®¢å•çŠ¶æ€è®¾ä¸ºå¾…æ”¯ä»˜
    
    2024-01-15 16:15:01 ERROR [FileService] æ–‡ä»¶è¯»å–å¤±è´¥: FileNotFound
    2024-01-15 16:15:02 WARN [FileService] å°è¯•ä»å¤‡ä»½ä½ç½®è¯»å–
    2024-01-15 16:15:03 ERROR [FileService] å¤‡ä»½æ–‡ä»¶ä¹Ÿä¸å­˜åœ¨
    """
    
    print("ğŸ“‹ ç¤ºä¾‹åˆ†æç»“æœ:")
    print("-" * 40)
    print(sample_analysis[:300] + "...")
    
    print("\nğŸ“‹ ç¤ºä¾‹åŸå§‹æ—¥å¿—:")
    print("-" * 40)
    print(sample_logs[:300] + "...")
    
    print("\nğŸ¯ è°ƒç”¨è¯„åˆ¤æ¨¡å‹è¿›è¡Œè¯„ä¼°...")
    print("-" * 40)
    
    try:
        # è°ƒç”¨è¯„åˆ¤æ¨¡å‹
        critic_result, score = critic_analysis(sample_analysis, sample_logs, model_name="Qwen/Qwen3-8B")
        
        print("\nğŸ“Š === è¯„åˆ¤æ¨¡å‹è¾“å‡ºç»“æœ ===")
        print("=" * 60)
        print(critic_result)
        print(f"ğŸ¯ è¯„åˆ¤æ¨¡å‹è¯„åˆ†ï¼š{score}")
        print("\nâœ… æµ‹è¯•å®Œæˆï¼è¯„åˆ¤æ¨¡å‹è¿è¡Œæ­£å¸¸")
        return True
        
    except Exception as e:
        print(f"\nâŒ æµ‹è¯•å¤±è´¥: {e}")
        return False


def test_simple_case():
    """
    æµ‹è¯•ç®€å•æ¡ˆä¾‹
    """
    print("\nğŸ§ª æµ‹è¯•ç®€å•æ¡ˆä¾‹")
    print("=" * 60)
    
    # ç®€å•çš„åˆ†æç»“æœ
    simple_analysis = "æ—¥å¿—æ­£å¸¸ï¼Œæ²¡æœ‰å‘ç°å¼‚å¸¸"
    simple_logs = "2024-01-15 10:00:01 INFO [App] åº”ç”¨å¯åŠ¨æˆåŠŸ"
    
    try:
        result, score = critic_analysis(simple_analysis, simple_logs, model_name="Qwen/Qwen3-8B")
        print("ğŸ“Š ç®€å•æ¡ˆä¾‹è¯„åˆ¤ç»“æœ:")
        print("-" * 40)
        print(result)
        print(f"ğŸ¯ è¯„åˆ¤æ¨¡å‹è¯„åˆ†ï¼š{score}")
        return True
    except Exception as e:
        print(f"âŒ ç®€å•æ¡ˆä¾‹æµ‹è¯•å¤±è´¥: {e}")
        return False


if __name__ == "__main__":
    print("ğŸ”¬ è¯„åˆ¤æ¨¡å‹åŠŸèƒ½æµ‹è¯•")
    print("=" * 80)
    
    # æµ‹è¯•ä¸»è¦åŠŸèƒ½
    # test1_result = test_critic_model()
    
    # æµ‹è¯•ç®€å•æ¡ˆä¾‹
    test2_result = test_simple_case()
    
    print("\nğŸ“‹ æµ‹è¯•æ€»ç»“:")
    print("=" * 80)
    # print(f"âœ… ä¸»è¦åŠŸèƒ½æµ‹è¯•: {'é€šè¿‡' if test1_result else 'å¤±è´¥'}")
    print(f"âœ… ç®€å•æ¡ˆä¾‹æµ‹è¯•: {'é€šè¿‡' if test2_result else 'å¤±è´¥'}")
    
    # if test1_result and test2_result:
    if test2_result:
        print("\nğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼è¯„åˆ¤æ¨¡å‹åŠŸèƒ½æ­£å¸¸")
    else:
        print("\nâš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®å’Œç½‘ç»œè¿æ¥")
    
    print(f"\nğŸ’¡ ä½¿ç”¨æç¤º:")
    print(f"   - ç¡®ä¿APIå¯†é’¥æœ‰æ•ˆä¸”ç½‘ç»œè¿æ¥æ­£å¸¸")
    print(f"   - è¯„åˆ¤æ¨¡å‹ä½¿ç”¨GLM-4-9Bæ¨¡å‹ï¼Œæä¾›ä¸“ä¸šçš„è´¨é‡è¯„ä¼°")
    print(f"   - å¯ä»¥åœ¨summerize.pyä¸­ç›´æ¥ä½¿ç”¨critic_analysiså‡½æ•°") 